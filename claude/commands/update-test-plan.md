# update-test-plan
リポジトリの現状とソースコード解析からテスト計画を最新化（日本語版）

## 概要
analyze-repoの解析結果やソースコードの実装状況を基に、testPlan.mdを最新の状態に更新します。実装済み機能、未実装機能、新規追加された機能を識別し、包括的な日本語のテスト計画を維持します。

## 言語設定
- **ドキュメント言語**: 日本語
- **英語使用箇所**: ファイル名、コード、コマンド、一部の技術用語のみ

## 実行内容

### 0. 前提条件の確認
- `docs/testing/testPlan.md`の存在確認（なければ日本語で新規作成）
- `docs/repository_analysis_*.md`の最新版を参照
- カバレッジレポートの存在確認（あれば実際の数値を使用）
- プロジェクトのメインエントリーポイントの特定
- テストファイルの配置とネーミング規則の確認

### 1. ソースコード解析
- **メイン実装の解析**
  - Python: `src/`, `*.py`ファイル
  - Rust: `src/`, `rust*/src/`ディレクトリ
  - エントリーポイントからの関数呼び出しツリー作成
  - 公開API/エクスポート関数の一覧化

- **既存テストの解析**
  - テストファイルの検出（`test*.py`, `*_test.py`, `tests/`）
  - テストカバレッジの確認（可能な場合は実際の数値を取得）
  - テストされている機能の一覧化
  - テストされていない機能の特定

### 2. テスト計画の構造化

#### 2.1 テストカテゴリの分類
- **単体テスト**
  - 個別関数/メソッドのテスト
  - エッジケースの検証
  - エラーハンドリングの確認

- **統合テスト**
  - モジュール間連携
  - データフロー全体の検証
  - 外部システムとの連携

- **エンドツーエンドテスト**
  - 実使用シナリオの再現
  - パフォーマンステスト
  - 負荷テスト

#### 2.2 優先度の設定（日本語表記）
- **P0（緊急）**: システム停止リスク、データ破損リスクあり
- **P1（重要）**: コア機能、頻繁に使用される
- **P2（高）**: 主要機能、通常使用される
- **P3（中）**: 補助機能、時々使用される
- **P4（低）**: オプション機能、めったに使用されない

### 3. テスト計画の更新内容

#### 3.1 新規追加すべきテスト
- ソースコード解析で発見された未テスト機能
- 最近追加された新機能
- リファクタリングされた既存機能

#### 3.2 既存テストの更新
- 廃止された機能のテスト削除
- 変更された仕様に合わせたテスト修正
- テストコードのリファクタリング提案

#### 3.3 テスト実装の詳細
各テストケースに以下を日本語で記載：
```markdown
### テスト名: [機能名]のテスト
- **対象関数**: `module.function()`
- **テストファイル**: `test/test_feature.py`
- **優先度**: 高
- **ステータス**: 未実装/実装済み/要更新
- **テストケース**:
  1. 正常系: 期待される入力と出力
  2. 異常系: エラーケースの処理
  3. 境界値: 限界値での動作
```

### 4. テスト環境とツール

#### 4.1 必要な環境変数
```bash
export GPUPASER_PG_DSN="..."
export GPUPGPARSER_TEST_MODE=1
```

#### 4.2 テストフレームワーク
- Python: pytest, unittest
- Rust: cargo test
- GPU関連: CUDA環境の確認

### 5. テスト実行計画

#### 5.1 実行順序
1. 環境セットアップの検証
2. 単体テストの実行
3. 統合テストの実行
4. E2Eテストの実行
5. パフォーマンステストの実行

#### 5.2 CI/CD統合
- GitHub Actions設定例
- テスト自動化のトリガー
- テスト結果の通知設定

### 6. テストカバレッジ目標
- 全体カバレッジ: 80%以上
- コア機能カバレッジ: 95%以上
- エラーハンドリング: 100%

### 7. テストデータ管理
- テストデータの配置: `test_data/`, `test_binaries/`
- モックデータの生成方法
- 大規模データセットの扱い

### 8. 出力ファイルの検証
- 日本語の自然性チェック
- markdown構文チェック
- テスト計画の一貫性確認
- 実装可能性の検証

## 出力形式

### 言語に関する詳細指示
- **ドキュメント本文**: 完全に日本語で記載
- **見出し**: 日本語で記載
- **説明文**: 日本語で記載
- **テーブルヘッダー**: 日本語で記載（例：「コンポーネント」「場所」「テスト状況」「優先度」「備考」）
- **ステータス表記**: 日本語（例：「未実装」「部分的」「完了」「テスト済み」）
- **優先度表記**: 日本語（例：「緊急」「重要」「高」「中」「低」）

### 英語のまま残すもの
- ファイルパス（例：`src/cuda_kernels/`）
- 関数名、クラス名（例：`DirectProcessor`）
- コマンド、環境変数（例：`export GPUPASER_PG_DSN`）
- コードブロック内のコード
- 技術用語で日本語化が不自然なもの（例：CI/CD、GPU、CUDA）

### ファイル出力
- **更新対象**: `docs/testing/testPlan.md`（日本語）
- **バックアップ**: 既存ファイルを`testPlan.md.backup`として保存
- **差分レポート**: `docs/testing/test_plan_update_YYYYMMDD.md`に変更内容を記録（日本語）
- **形式**: Markdownテーブルとチェックリスト形式

## 特徴
- ソースコードから自動的にテスト対象を抽出
- 既存テストとのギャップ分析
- 優先度に基づいた実装順序の提案（日本語の優先度表記）
- テスト実装の具体例を含む
- CI/CD統合を考慮した構成
- 完全な日本語化（技術的な部分を除く）

## 成功基準チェックリスト
- [ ] すべての見出しが日本語で記載されている
- [ ] テーブルヘッダーが日本語になっている
- [ ] ステータス表記が日本語（「未実装」「部分的」「完了」など）
- [ ] 優先度表記が日本語（「重要」「高」「中」「低」など）
- [ ] 説明文が自然な日本語で書かれている
- [ ] コード部分とファイルパスは英語のまま
- [ ] 技術用語は適切に英語/日本語が選択されている

## 実行例
```bash
/update-test-plan
```

## 注意事項
- 大規模プロジェクトの場合、解析に時間がかかる可能性があります
- GPUテストは適切な環境でのみ実行可能です
- テストデータのサイズに注意してください
- 出力は必ず日本語で行われることを確認してください